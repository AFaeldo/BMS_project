@{
    Layout = "~/Views/Shared/_LayoutSuperAdmin.cshtml";
    ViewData["Title"] = "Settings";
}

<div class="container-fluid">

    <!-- PAGE HEADER -->
    <div class="mb-4">
        <h2 class="fw-bold">System Settings</h2>
    </div>

    @* <section class="mb-4">
        <div class="card border-0 shadow-sm rounded-3">
            <div class="card-header bg-transparent d-flex align-items-center justify-content-between">
                <h6 class="fw-bold text-dark text-uppercase mb-0">User Management</h6>
            </div>
            <div class="card-body d-flex align-items-center justify-content-center">
                <div class="d-flex flex-wrap gap-2 justify-content-center w-100">
                    <!-- Replace controller/action with your actual endpoints -->
                    <a asp-controller="SuperAdmin" asp-action="AssignRoles"
                       class="btn btn-success btn-sm" role="button" title="Assign roles to users">
                        <i class="bi bi-person-check-fill me-1" aria-hidden="true"></i>
                        Assign Roles
                    </a>

                    <a asp-controller="SuperAdmin" asp-action="ManagePermissions"
                       class="btn btn-outline-primary btn-sm" role="button" title="Manage permissions">
                        <i class="bi bi-shield-lock me-1" aria-hidden="true"></i>
                        Manage Permissions
                    </a>

                    <a asp-controller="SuperAdmin" asp-action="ManageUsers"
                       class="btn btn-outline-secondary btn-sm" role="button" title="Manage users">
                        <i class="bi bi-people-fill me-1" aria-hidden="true"></i> Manage Users
                    </a>
                </div>
            </div>
        </div>
    </section> *@

    <section class="mt-4">
        <div class="card border-0 shadow-sm rounded-3">
            <div class="card-header bg-transparent d-flex align-items-center justify-content-between">
                <h6 class="fw-bold text-dark text-uppercase mb-0">System Summary</h6>
            </div>

            <div class="card-body">
                <div class="row align-items-center gy-3">
                    <div class="col-12 col-sm-4 text-center">
                        <div class="p-3">
                            <h6 class="mb-1 text-muted">Users</h6>
                            <h3 class="fw-bold mb-0">@((Model?.UsersCount != null) ? Model.UsersCount.ToString() : "-")</h3>
                        </div>
                    </div>

                    <div class="col-12 col-sm-4 text-center">
                        <div class="p-3">
                            <h6 class="mb-1 text-muted">Last Backup</h6>
                            <h3 class="fw-bold mb-0">
                                @{
                                    var lastBackupText = "-";
                                    if (Model?.LastBackup != null)
                                    {
                                        lastBackupText = Model.LastBackup.Value.ToString("yyyy-MM-dd HH:mm");
                                    }
                                }
                                @lastBackupText
                            </h3>
                        </div>
                    </div>

                    <div class="col-12 col-sm-4 text-center">
                        <div class="p-3">
                            <h6 class="mb-1 text-muted">Uptime</h6>
                            <h3 class="fw-bold mb-0">@(!string.IsNullOrWhiteSpace(Model?.Uptime) ? Model.Uptime : "-")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</div>

<!-- RESET MODAL -->
<div class="modal fade" id="resetModalCompact" tabindex="-1" aria-labelledby="resetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <form asp-controller="SuperAdmin" asp-action="ResetAllAccounts" method="post" class="modal-content" id="resetForm">
            @Html.AntiForgeryToken()
            <div class="modal-header bg-danger text-white">
                <h6 class="modal-title mb-0" id="resetModalLabel">Reset All Accounts</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body small">
                <p class="mb-2 text-center">This action will reset all accounts. This cannot be undone.</p>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" value="true" id="confirmResetCheck" aria-describedby="resetHelp">
                    <label class="form-check-label small" for="confirmResetCheck">
                        Yes, I understand and want to reset all accounts
                    </label>
                </div>

                <div class="d-grid">
                    <button id="confirmResetBtn" type="submit" class="btn btn-danger btn-sm" disabled>
                        <span id="confirmResetBtnText">Confirm Reset</span>
                        <span id="confirmResetSpinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Toast (reusable) -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
    <div id="appToast" class="toast" role="alert" aria-live="polite" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">System</strong>
            <small class="text-muted"></small>
            <button type="button" class="btn-close ms-2 mb-1" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="appToastBody"></div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
            var check = document.getElementById('confirmResetCheck');
            var btn = document.getElementById('confirmResetBtn');
            var spinner = document.getElementById('confirmResetSpinner');

            if (check && btn) {
                check.addEventListener('change', function () {
                    btn.disabled = !this.checked;
                });

                var form = document.getElementById('resetForm');
                form && form.addEventListener('submit', function (evt) {
                    btn.disabled = true;
                    spinner.classList.remove('d-none');
                });
            }

            function showToast(message) {
                var toastEl = document.getElementById('appToast');
                document.getElementById('appToastBody').textContent = message;
                var t = new bootstrap.Toast(toastEl);
                t.show();
            }

            // No backup actions here — use the Backup & Maintenance page for backups.
        })();
    </script>
}
