
@{
    Layout = "~/Views/Shared/_LayoutSuperAdmin.cshtml";
    ViewData["Title"] = "Settings";
}

<div class="container-fluid">

    <!-- PAGE HEADER -->
    <div class="mb-4">
        <h2 class="fw-bold">System Settings</h2>
    </div>

    <section class="mb-4">
        <div class="row g-3">
            <!-- USER MANAGEMENT -->
            <div class="col-md-6">
                <div class="card border-0 shadow-sm rounded-3 h-100">
                    <div class="card-header bg-transparent d-flex align-items-center justify-content-between">
                        <h6 class="fw-bold text-dark text-uppercase mb-0">User Management</h6>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center">
                        <div class="d-flex flex-wrap gap-2 justify-content-center w-100">
                            <button type="button" class="btn btn-success btn-sm" title="Assign roles to users">
                                <i class="bi bi-person-check-fill me-1" aria-hidden="true"></i>
                                Assign Roles
                            </button>

                            <button type="button" class="btn btn-outline-primary btn-sm" title="Manage permissions">
                                <i class="bi bi-shield-lock me-1" aria-hidden="true"></i>
                                Manage Permissions
                            </button>

                            @* Use tag-helpers: palitan ang controller/action ayon sa project *@
                            <a asp-controller="SuperAdmin" asp-action="ManageUsers" class="btn btn-outline-secondary btn-sm" role="button" title="Manage users">
                                <i class="bi bi-people-fill me-1" aria-hidden="true"></i> Manage Users
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- SYSTEM CONTROL -->
            <div class="col-md-6">
                <div class="card border-0 shadow-sm rounded-3 h-100">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h6 class="fw-bold text-dark text-uppercase mb-0">System Control</h6>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center">
                        <div class="d-flex flex-wrap gap-2 justify-content-center w-100">
                            <a asp-controller="SystemLogs" asp-action="Index" class="btn btn-outline-secondary btn-sm" role="button" title="View system logs">
                                <i class="bi bi-journal-text me-1" aria-hidden="true"></i> View Logs
                            </a>

                            <a asp-controller="SuperAdmin" asp-action="BackupMaintenance" class="btn btn-warning btn-sm" role="button" title="Run backup now">
                                <i class="bi bi-cloud-arrow-up-fill me-1" aria-hidden="true"></i> Backup Now
                            </a>

                            <button type="button" class="btn btn-secondary btn-sm" title="Run maintenance tasks">
                                <i class="bi bi-gear-fill me-1" aria-hidden="true"></i> Run Maintenance
                            </button>

                          
                            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#resetModalCompact" aria-controls="resetModalCompact" title="Reset all accounts">
                                <i class="bi bi-arrow-clockwise me-1" aria-hidden="true"></i> Reset Accounts
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mt-4">
        <div class="card border-0 shadow-sm rounded-3">
            <div class="card-header bg-transparent d-flex align-items-center justify-content-between">
                <h6 class="fw-bold text-dark text-uppercase mb-0">System Summary</h6>
            </div>

            <div class="card-body">
                <div class="row text-center gy-3">
                    <div class="col-12 col-sm-4">
                        <div class="p-3">
                            <h6 class="mb-1 text-muted">Users</h6>
                            <h3 class="fw-bold mb-0">@((Model?.UsersCount != null) ? Model.UsersCount.ToString() : "-")</h3>
                        </div>
                    </div>

                    <div class="col-12 col-sm-4">
                        <div class="p-3">
                            <h6 class="mb-1 text-muted">Last Backup</h6>
                            <h3 class="fw-bold mb-0">
                                @{
                                    var lastBackupText = "-";
                                    if (Model?.LastBackup != null)
                                    {
                                        // safe format; change to whatever format/locale you prefer
                                        lastBackupText = Model.LastBackup.Value.ToString("yyyy-MM-dd HH:mm");
                                    }
                                }
                                @lastBackupText
                            </h3>
                        </div>
                    </div>

                    <div class="col-12 col-sm-4">
                        <div class="p-3">
                            <h6 class="mb-1 text-muted">Uptime</h6>
                            <h3 class="fw-bold mb-0">@(!string.IsNullOrWhiteSpace(Model?.Uptime) ? Model.Uptime : "-")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


</div>

<!-- RESET MODAL -->
<div class="modal fade" id="resetModalCompact" tabindex="-1" aria-labelledby="resetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <form asp-controller="SuperAdmin" asp-action="ResetAllAccounts" method="post" class="modal-content">
            @Html.AntiForgeryToken()
            <div class="modal-header bg-danger text-white">
                <h6 class="modal-title mb-0" id="resetModalLabel">Reset All Accounts</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body small">
                <p class="mb-2 text-center">This action will reset all accounts. This cannot be undone.</p>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" value="true" id="confirmResetCheck">
                    <label class="form-check-label small" for="confirmResetCheck">
                        Yes, I understand and want to reset all accounts
                    </label>
                </div>

                <div class="d-grid">
                    <button id="confirmResetBtn" type="submit" class="btn btn-danger btn-sm" disabled>
                        <span id="confirmResetBtnText">Confirm Reset</span>
                        <span id="confirmResetSpinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
            var check = document.getElementById('confirmResetCheck');
            var btn = document.getElementById('confirmResetBtn');
            var spinner = document.getElementById('confirmResetSpinner');

            if (check && btn) {
                check.addEventListener('change', function () {
                    btn.disabled = !this.checked;
                });

                
                btn && btn.form && btn.form.addEventListener('submit', function (evt) {
                    
                    btn.disabled = true;
                    spinner.classList.remove('d-none');
                });
            }
        })();
    </script>
}
